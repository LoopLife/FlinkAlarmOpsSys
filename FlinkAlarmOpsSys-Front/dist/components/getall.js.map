{"version":3,"sources":["../../src/components/getall.js"],"names":["init","$","get","allRulesUrl","rulesdata","each","id","rule","rulesMap","ruleid","content","allJobsUrl","data","rulesObj","index","obj","appendHtml","jobId","jobName","rules","split","length","modelInit","dialogInit","append","css","click","alert","ruleArray","itemindex","indexOf","splice","rStr","ajax","type","url","updateJobUrl","JSON","stringify","dataType","contentType","success","result","console","log","error","e","status","responseText","resultObj","parse","ret","remove","modelContent","rulesStr","htmlStr","deleteRuleById","urlstr","deleteRuleUrl","Object","rulesArrayList"],"mappings":"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","sourcesContent":["\r\nvar allJobsUrl=\"http://localhost:8080/api/jobs/alljobs\" \r\nvar allRulesUrl=\"http://localhost:8080/api/rules/allrules\"\r\nvar deleteRuleUrl=\"http://localhost:8080/api/rules/deleterule/\"\r\nvar updateJobUrl=\"http://localhost:8080/api/jobs/updatejob/\"\r\nvar appendHtml=\"\"//Container+Model添加的总HTML\r\nvar rulesMap=new Object()//键值对映射表\r\nvar modelContent=\"\"//Model添加的总HTML\r\nvar rulesArrayList=new Object()//全局对象\r\nvar rulesObj=new Object()\r\n//init()\r\n\r\nfunction init(){\r\n$.get(allRulesUrl,function(rulesdata){\r\n/**\r\n * @summary:API GetAll:rules表,遍历构建键值对\r\n */\r\n    $.each(rulesdata,function(id,rule){\r\nrulesMap[rule.ruleid]=rule.content\r\n    });\r\n\r\n/**\r\n * @summary:API GetAll:jobs表,遍历组装成HTML\r\n * @return:JSON:[{ruleid:,content:}]\r\n */\r\n    $.get(allJobsUrl,function(data){\r\n         //初始化[jobs表]全局变量↓\r\n         rulesObj=data\r\n        $.each(data,function(index,obj)\r\n        　　{\r\n    //HTML拼接↓\r\n    appendHtml=\"<div class='container' ><div class='containerinfo'>\"\r\n        +\"<div class='containertitle'>信息详情</div><div class='jobtype'>Log关键字过滤报警形任务</div>\"\r\n        +\"<table style='width:95%'>\"\r\n        +\"<tr><th>ID</th><td>\"+obj.jobId+\"</td> </tr>\"\r\n        +\"<tr><th>名称</th><td>\"+obj.jobName+\"</td>\"\r\n        +\"  </tr> <tr><th>关键字条数</th><td>\"+rulesObj[index].rules.split(\",\").length+\"</td>\"\r\n        +\"   </tr><tr><th>报警阈值</th><td>NULL</td></tr></table></div>\"\r\n        +\"  <div class='containerbtns'>\"\r\n        +\"<button id='showbtn' class='gbutton' \"\r\n        +\"onclick=\\\"$('#myModal_\"+obj.jobId+\"').css('display','block');\"\r\n        +\"$('#close_\"+obj.jobId+\"').click(function(){\"\r\n            +\"$('#myModal_\"+obj.jobId+\"').css('display','none');});\\\">配置过滤关键字</button>\"\r\n            +\"<button class='gbutton' type='button'>配置报警阈值</button>\"\r\n            +\"<input class='gbutton' type='button' value='修改任务名称' />\"\r\n            +\"<input class='gbutton' type='button' value='Flink集群监控' /></div></div>\"\r\n\r\n            +\"<div id='myModal_\"+obj.jobId+\"' class='modal' style='padding-top:50px'><span id='close_\"+obj.jobId+\"'><button type='button' class='dialogclose'>关闭</button></span><div class='containertitle'>配置过滤关键字</div><div class='jobtype'>\"+obj.jobName+\"</div>\"+modelInit(rulesObj[index].rules,index)+\"<div id='caption_\"+obj.jobId+\"'></div></div>\"\r\n            +dialogInit(rulesObj[index].rules,index);\r\n\r\n    $('#containers').append(appendHtml)   \r\n    $('#loadingdialog').css('display','none');\r\n    $('.wait').css('display','none');\r\n    $(\"#add\"+index).click(function(){\r\n        alert(\"请输入新增的规则名称,index:\"+index)\r\n    }) \r\n/**\r\n *@summary:在插入HTML之后对所有【删除】按钮的指定id进行click事件绑定\r\n */\r\n    $.each(rulesObj[index].rules.split(','),function(id,ruleid){\r\n     $(\"#del\"+index+ruleid).click(function (){\r\n       var ruleArray=rulesObj[index].rules.split(',')\r\n        var itemindex = ruleArray.indexOf(ruleid);\r\n        if (itemindex > -1){ruleArray.splice(itemindex, 1);}\r\n        var rStr=\"\"\r\n        $.each(ruleArray,function(id,rule){\r\n            rStr+=rule\r\n            if(id!=ruleArray.length-1)\r\n            {rStr+=','}\r\n        });\r\n        rulesObj[index].rules=rStr\r\n        $.ajax({\r\n            type:\"PUT\",\r\n            url:updateJobUrl+rulesObj[index].jobId,\r\n            data:JSON.stringify(rulesObj[index]),\r\n            dataType:\"application/json\",\r\n            contentType:\"application/json\",\r\n            success : function(result) {\r\n                console.log(result);\r\n            },\r\n            error : function(e){\r\n                console.log(e.status);\r\n                console.log(e.responseText);\r\n                $('#dialog'+index+ruleid).css('display','none');\r\n                var resultObj=JSON.parse(e.responseText)\r\n                if(!resultObj.ret){\r\n                    $(\"#li\"+index+ruleid).remove()\r\n                }\r\n            }\r\n        })\r\n    });\r\n     });\r\n    });\r\n    modelContent=\"\"   \r\n        　　});\r\n       \r\n        }); \r\n}\r\n\r\n/**\r\n * @param:给定Rules ID字符串\r\n * @summary：分割字符串为数组，遍历Map表从中取字段插入到Html中\r\n * @returns: 组装生成的HTML\r\n}\r\n$('#reinit').click(function(){\r\n    init();\r\n});\r\n * \r\n *  */\r\n\r\nfunction dialogInit(rulesStr,index)\r\n{\r\n    var htmlStr=\"\"\r\n    var ruleArray=rulesStr.split(',')\r\n      $.each(ruleArray,function(id,ruleid){\r\n       htmlStr+=\"<div id='dialog\"+index+ruleid+\"' class='dialog'>\"\r\n       +\"<div class='dialoginner'>\"\r\n       +\"<span class='dialogTitle'>请确认本次操作删除的内容</span>\"\r\n       +\" <ul class='dialogul'>\"\r\n       +\"     <li>▮ 将要删除的字段：\"+rulesMap[ruleid]+\"</li>\"\r\n       +\"     <li>▮ 字段所属任务ID: \"+rulesObj[index].jobId+\"</li>\"\r\n       +\"     <li>▮ 确认删除吗？</li>\"\r\n       +\"  </ul> \"\r\n       +\"<div class='dialogbtns'><input id='del\"+index+ruleid+\"' class='gbutton' type='button' value='确认' style='background-color: orangered;' /></li><input id='closeDialog\"+index+ruleid+\"' class='gbutton' type='button' style='color: black;background-color: gray;' value='取消' /></li></div>\"\r\n       +\"</div>\"\r\n       +\"</div>\";\r\n    });\r\n    return htmlStr\r\n}\r\nfunction modelInit(rulesStr,index){\r\n    var htmlStr=\"<table style='width:95%;margin: 15px 0 100px 15px;'><tr><th>ID</th> <th>规则内容</th> <th class='dialogtd'></th> <th class='dialogtd'></th></tr>\"\r\n    var ruleArray=rulesStr.split(',')\r\n      $.each(ruleArray,function(id,ruleid){\r\n       htmlStr+=\"<tr id='li\"+index+ruleid+\"' style='background-color: #9ccadcf2;'><td ><p style='width: 30px;'>\"+id+\"</p></td> <td class='dialogtdrule' style='background-color: #9ccadcf2;'><p style='width: 300px;'>\"+rulesMap[ruleid]+\"</p></td><th class='dialogtd'><button type='input' class='gbutton dialogBtn'>修改</button></th>\"\r\n       +\"<th class='dialogtd'><button  onclick=\\\"$('#dialog\"+index+ruleid+\"').css('display','block');\"\r\n       +\"$('#closeDialog\"+index+ruleid+\"').click(function(){\"\r\n       +\"$('#dialog\"+index+ruleid+\"').css('display','none')\"\r\n       +\"});\\\" class='gbutton dialogBtn'>删除</button></th></tr>\"\r\n    });\r\n    htmlStr+=\"<tr><th>END</th> <th></th> <th class='dialogtd'></th> <th class='dialogtd'></th></tr></table><button id='add\"+index+\"' class='gbutton addbtn' >添加规则</button>\"\r\n    return htmlStr\r\n}\r\n function deleteRuleById(id){\r\n        alert(\"cl!\")\r\n        var urlstr=deleteRuleUrl+id\r\n        $.ajax({\r\n            type: \"delete\",\r\n            url: urlstr,\r\n            success: function (data) {\r\n             alert(\"Delete Successfuly\")\r\n             $(\"#li_\"+id).remove\r\n            }});\r\n    }\r\n//    +\"onclick=\\\"\"\r\n//       +\"$.ajax({\"\r\n//       +\"type: 'delete',\"\r\n//       +\"url: 'http://localhost:8080/api/rules/deleterule/\"+ruleid+\"',\"\r\n//     +\" success: function (data) {if(data.deleted){$('#li_\"+id+\"_\"+ruleid+\"').remove()};}});\r\n\r\n//老插入代码\r\n    // appendHtml=\"<div class='container' ><ul style='list-style-type:none'><li>\"\r\n    // +\"<h2>ID:\"+obj.jobId+\"</h2></li><li><h2>Name:\"+obj.jobName+\"<input class='gbutton' type='button' value='修改' onload='init()' /></h2></li></ul>\"\r\n    // +\"<button id='showbtn_\"+obj.jobId+\"' class='gbutton'style='width: 100%;height: 60px;' \"\r\n    // +\"onclick=\\\"$('#myModal_\"+obj.jobId+\"').css('display','block');$('#close_\"+obj.jobId+\"').click(function(){$('#myModal_\"+obj.jobId+\"').css('display','none');});\\\">配置过滤关键字</button></div>\"\r\n\r\n    // +\"<div id='myModal_\"+obj.jobId+\"' class='modal'>This is the Model DIV_+\"+modelInit(rulesObj[index].rules,index)+\"<span id='close_\"+obj.jobId+\"'class='close'><button type='button' class='btn btn-info'>关闭</button></span><div id='caption_\"+obj.jobId+\"'></div></div>\"\r\n    // +dialogInit(rulesObj[index].rules,index);\r\n\r\n\r\n    \r\n   "],"file":"getall.js"}