{"version":3,"sources":["../../src/components/clippy.js"],"names":["window","clippy","Agent","path","data","sounds","_queue","Queue","$","proxy","_onQueueEmpty","_el","hide","document","body","append","_animator","Animator","_balloon","Balloon","_setupEvents","prototype","gestureAt","x","y","d","_getDirection","gAnim","lookAnim","animation","hasAnimation","play","fast","callback","_hidden","el","stop","pause","_playInternal","moveTo","duration","dir","anim","undefined","_addToQueue","complete","css","top","left","reposition","animate","name","state","States","EXITED","WAITING","exitAnimation","_isIdleAnimation","_idleDfd","done","showAnimation","timeout","cb","completed","setTimeout","show","resume","width","height","scrollTop","speak","text","hold","closeBalloon","delay","time","stopCurrent","close","clear","animations","Math","floor","random","length","indexOf","offset","h","w","centerX","centerY","a","b","r","round","atan2","PI","idleAnim","_getIdleAnimation","Deferred","_onIdleComplete","resolve","c","currentAnimationName","i","push","idx","on","_onMouseDown","_onDoubleClick","is","o","bH","outerHeight","bW","outerWidth","wW","wH","sT","sL","scrollLeft","m","e","preventDefault","_startDrag","_offset","_calculateClickOffset","_moveHandle","_dragMove","_upHandle","_finishDrag","_dragUpdateLoop","_updateLocation","mouseX","pageX","mouseY","pageY","_targetY","_taregtX","clientX","clientY","clearTimeout","off","func","scope","queue","_data","_path","_currentFrameIndex","_currentFrame","_exiting","_currentAnimation","_endCallback","_started","_sounds","preloadSounds","_overlays","curr","_setupElement","overlayCount","inner","frameSize","framesize","n","snd","uri","Audio","animationName","stateChangeCallback","_step","_draw","images","xy","bg","_getNextAnimationFrame","currentFrame","branching","exitBranch","rnd","branches","branch","weight","frameIndex","_playSound","s","sound","audio","_atLastFrame","frames","newFrameIndex","min","frameChanged","useExitBranching","_loop","targetEl","_targetEl","_setup","WORD_SPEAK_TIME","CLOSE_BALLOON_DELAY","_content","find","sides","_position","_isOut","_BALLOON_MARGIN","side","removeClass","addClass","_complete","_sayWords","_hiding","_finishHideBalloon","_active","_hold","words","split","_addWord","slice","join","BASE_PATH","load","successCb","failCb","mapDfd","_loadMap","agentDfd","_loadAgent","soundsDfd","_loadSounds","when","fail","_maps","dfd","src","img","Image","onload","onerror","reject","setAttribute","promise","createElement","canPlayMp3","canPlayType","canPlayOgg","_loadScript","_getAgentDfd","script","head","appendChild","ready","soundsReady","onEmptyCallback","_onEmptyCallback","_progressQueue","f","shift","completeFunction","next","call"],"mappings":"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","sourcesContent":["// thank you Smore for this wonderful script!\n// https://www.smore.com/clippy-js\n\n;(function() {\n\n    window.clippy = {};\n    /******\n     *\n     *\n     * @constructor\n     */\n    clippy.Agent = function (path, data, sounds) {\n        this.path = path;\n\n        this._queue = new clippy.Queue($.proxy(this._onQueueEmpty, this));\n\n        this._el = $('<div class=\"clippy\"></div>').hide();\n\n        $(document.body).append(this._el);\n\n        this._animator = new clippy.Animator(this._el, path, data, sounds);\n\n        this._balloon = new clippy.Balloon(this._el);\n\n        this._setupEvents();\n    };\n\n    clippy.Agent.prototype = {\n\n        /**************************** API ************************************/\n\n        /***\n         *\n         * @param {Number} x\n         * @param {Number} y\n         */\n        gestureAt:function (x, y) {\n            var d = this._getDirection(x, y);\n            var gAnim = 'Gesture' + d;\n            var lookAnim = 'Look' + d;\n\n            var animation = this.hasAnimation(gAnim) ? gAnim : lookAnim;\n            return this.play(animation);\n        },\n\n        /***\n         *\n         * @param {Boolean=} fast\n         *\n         */\n        hide:function (fast, callback) {\n            this._hidden = true;\n            var el = this._el;\n            this.stop();\n            if (fast) {\n                this._el.hide();\n                this.stop();\n                this.pause();\n                if (callback) callback();\n                return;\n            }\n\n            return this._playInternal('Hide', function () {\n                el.hide();\n                this.pause();\n                if (callback) callback();\n            })\n        },\n\n\n        moveTo:function (x, y, duration) {\n            var dir = this._getDirection(x, y);\n            var anim = 'Move' + dir;\n            if (duration === undefined) duration = 1000;\n\n            this._addToQueue(function (complete) {\n                // the simple case\n                if (duration === 0) {\n                    this._el.css({top:y, left:x});\n                    this.reposition();\n                    complete();\n                    return;\n                }\n\n                // no animations\n                if (!this.hasAnimation(anim)) {\n                    this._el.animate({top:y, left:x}, duration, complete);\n                    return;\n                }\n\n                var callback = $.proxy(function (name, state) {\n                    // when exited, complete\n                    if (state === clippy.Animator.States.EXITED) {\n                        complete();\n                    }\n                    // if waiting,\n                    if (state === clippy.Animator.States.WAITING) {\n                        this._el.animate({top:y, left:x}, duration, $.proxy(function () {\n                            // after we're done with the movement, do the exit animation\n                            this._animator.exitAnimation();\n                        }, this));\n                    }\n\n                }, this);\n\n                this._playInternal(anim, callback);\n            }, this);\n        },\n\n        _playInternal:function (animation, callback) {\n\n            // if we're inside an idle animation,\n            if (this._isIdleAnimation() && this._idleDfd && this._idleDfd.state() === 'pending') {\n                this._idleDfd.done($.proxy(function () {\n                    this._playInternal(animation, callback);\n                }, this))\n            }\n\n            this._animator.showAnimation(animation, callback);\n        },\n\n        play:function (animation, timeout, cb) {\n            if (!this.hasAnimation(animation)) return false;\n\n            if (timeout === undefined) timeout = 5000;\n\n\n            this._addToQueue(function (complete) {\n                var completed = false;\n                // handle callback\n                var callback = function (name, state) {\n                    if (state === clippy.Animator.States.EXITED) {\n                        completed = true;\n                        if (cb) cb();\n                        complete();\n                    }\n                };\n\n                // if has timeout, register a timeout function\n                if (timeout) {\n                    window.setTimeout($.proxy(function () {\n                        if (completed) return;\n                        // exit after timeout\n                        this._animator.exitAnimation();\n                    }, this), timeout)\n                }\n\n                this._playInternal(animation, callback);\n            }, this);\n\n            return true;\n        },\n\n        /***\n         *\n         * @param {Boolean=} fast\n         */\n        show:function (fast) {\n\n            this._hidden = false;\n            if (fast) {\n                this._el.show();\n                this.resume();\n                this._onQueueEmpty();\n                return;\n            }\n\n            if (this._el.css('top') === 'auto' || !this._el.css('left') === 'auto') {\n                var left = $(window).width() * 0.8;\n                var top = ($(window).height() + $(document).scrollTop()) * 0.8;\n                this._el.css({top:top, left:left});\n            }\n\n            this.resume();\n            return this.play('Show');\n        },\n\n        /***\n         *\n         * @param {String} text\n         */\n        speak:function (text, hold) {\n            this._addToQueue(function (complete) {\n                this._balloon.speak(complete, text, hold);\n            }, this);\n        },\n\n\n        /***\n         * Close the current balloon\n         */\n        closeBalloon:function () {\n            this._balloon.hide();\n        },\n\n        delay:function (time) {\n            time = time || 250;\n\n            this._addToQueue(function (complete) {\n                this._onQueueEmpty();\n                window.setTimeout(complete, time);\n            });\n        },\n\n        /***\n         * Skips the current animation\n         */\n        stopCurrent:function () {\n            this._animator.exitAnimation();\n            this._balloon.close();\n        },\n\n\n        stop:function () {\n            // clear the queue\n            this._queue.clear();\n            this._animator.exitAnimation();\n            this._balloon.hide();\n        },\n\n        /***\n         *\n         * @param {String} name\n         * @returns {Boolean}\n         */\n        hasAnimation:function (name) {\n            return this._animator.hasAnimation(name);\n        },\n\n        /***\n         * Gets a list of animation names\n         *\n         * @return {Array.<string>}\n         */\n        animations:function () {\n            return this._animator.animations();\n        },\n\n        /***\n         * Play a random animation\n         * @return {jQuery.Deferred}\n         */\n        animate:function () {\n            var animations = this.animations();\n            var anim = animations[Math.floor(Math.random() * animations.length)];\n            // skip idle animations\n            if (anim.indexOf('Idle') === 0) {\n                return this.animate();\n            }\n            return this.play(anim);\n        },\n\n        /**************************** Utils ************************************/\n\n        /***\n         *\n         * @param {Number} x\n         * @param {Number} y\n         * @return {String}\n         * @private\n         */\n        _getDirection:function (x, y) {\n            var offset = this._el.offset();\n            var h = this._el.height();\n            var w = this._el.width();\n\n            var centerX = (offset.left + w / 2);\n            var centerY = (offset.top + h / 2);\n\n\n            var a = centerY - y;\n            var b = centerX - x;\n\n            var r = Math.round((180 * Math.atan2(a, b)) / Math.PI);\n\n            // Left and Right are for the character, not the screen :-/\n            if (-45 <= r && r < 45) return 'Right';\n            if (45 <= r && r < 135) return 'Up';\n            if (135 <= r && r <= 180 || -180 <= r && r < -135) return 'Left';\n            if (-135 <= r && r < -45) return 'Down';\n\n            // sanity check\n            return 'Top';\n        },\n\n        /**************************** Queue and Idle handling ************************************/\n\n        /***\n         * Handle empty queue.\n         * We need to transition the animation to an idle state\n         * @private\n         */\n        _onQueueEmpty:function () {\n            if (this._hidden || this._isIdleAnimation()) return;\n            var idleAnim = this._getIdleAnimation();\n            this._idleDfd = $.Deferred();\n\n            this._animator.showAnimation(idleAnim, $.proxy(this._onIdleComplete, this));\n        },\n\n        _onIdleComplete:function (name, state) {\n            if (state === clippy.Animator.States.EXITED) {\n                this._idleDfd.resolve();\n            }\n        },\n\n\n        /***\n         * Is the current animation is Idle?\n         * @return {Boolean}\n         * @private\n         */\n        _isIdleAnimation:function () {\n            var c = this._animator.currentAnimationName;\n            return c && c.indexOf('Idle') === 0;\n        },\n\n\n        /**\n         * Gets a random Idle animation\n         * @return {String}\n         * @private\n         */\n        _getIdleAnimation:function () {\n            var animations = this.animations();\n            var r = [];\n            for (var i = 0; i < animations.length; i++) {\n                var a = animations[i];\n                if (a.indexOf('Idle') === 0) {\n                    r.push(a);\n                }\n            }\n\n            // pick one\n            var idx = Math.floor(Math.random() * r.length);\n            return r[idx];\n        },\n\n        /**************************** Events ************************************/\n\n        _setupEvents:function () {\n            $(window).on('resize', $.proxy(this.reposition, this));\n\n            this._el.on('mousedown', $.proxy(this._onMouseDown, this));\n\n            this._el.on('dblclick', $.proxy(this._onDoubleClick, this));\n        },\n\n        _onDoubleClick:function () {\n            if (!this.play('ClickedOn')) {\n                this.animate();\n            }\n        },\n\n        reposition:function () {\n            if (!this._el.is(':visible')) return;\n            var o = this._el.offset();\n            var bH = this._el.outerHeight();\n            var bW = this._el.outerWidth();\n\n            var wW = $(window).width();\n            var wH = $(window).height();\n            var sT = $(window).scrollTop();\n            var sL = $(window).scrollLeft();\n\n            var top = o.top - sT;\n            var left = o.left - sL;\n            var m = 5;\n            if (top - m < 0) {\n                top = m;\n            } else if ((top + bH + m) > wH) {\n                top = wH - bH - m;\n            }\n\n            if (left - m < 0) {\n                left = m;\n            } else if (left + bW + m > wW) {\n                left = wW - bW - m;\n            }\n\n            this._el.css({left:left, top:top});\n            // reposition balloon\n            this._balloon.reposition();\n        },\n\n        _onMouseDown:function (e) {\n            e.preventDefault();\n            this._startDrag(e);\n        },\n\n\n        /**************************** Drag ************************************/\n\n        _startDrag:function (e) {\n            // pause animations\n            this.pause();\n            this._balloon.hide(true);\n            this._offset = this._calculateClickOffset(e);\n\n            this._moveHandle = $.proxy(this._dragMove, this);\n            this._upHandle = $.proxy(this._finishDrag, this);\n\n            $(window).on('mousemove', this._moveHandle);\n            $(window).on('mouseup', this._upHandle);\n\n            this._dragUpdateLoop = window.setTimeout($.proxy(this._updateLocation, this), 10);\n        },\n\n        _calculateClickOffset:function (e) {\n            var mouseX = e.pageX;\n            var mouseY = e.pageY;\n            var o = this._el.offset();\n            return {\n                top:mouseY - o.top,\n                left:mouseX - o.left\n            }\n\n        },\n\n        _updateLocation:function () {\n            this._el.css({top:this._targetY, left:this._taregtX});\n            this._dragUpdateLoop = window.setTimeout($.proxy(this._updateLocation, this), 10);\n        },\n\n        _dragMove:function (e) {\n            e.preventDefault();\n            var x = e.clientX - this._offset.left;\n            var y = e.clientY - this._offset.top;\n            this._taregtX = x;\n            this._targetY = y;\n        },\n\n        _finishDrag:function () {\n            window.clearTimeout(this._dragUpdateLoop);\n            // remove handles\n            $(window).off('mousemove', this._moveHandle);\n            $(window).off('mouseup', this._upHandle);\n            // resume animations\n            this._balloon.show();\n            this.reposition();\n            this.resume();\n\n        },\n\n        _addToQueue:function (func, scope) {\n            if (scope) func = $.proxy(func, scope);\n            this._queue.queue(func);\n        },\n\n        /**************************** Pause and Resume ************************************/\n\n        pause:function () {\n            this._animator.pause();\n            this._balloon.pause();\n\n        },\n\n        resume:function () {\n            this._animator.resume();\n            this._balloon.resume();\n        }\n\n    };\n\n    /******\n     *\n     *\n     * @constructor\n     */\n    clippy.Animator = function (el, path, data, sounds) {\n        this._el = el;\n        this._data = data;\n        this._path = path;\n        this._currentFrameIndex = 0;\n        this._currentFrame = undefined;\n        this._exiting = false;\n        this._currentAnimation = undefined;\n        this._endCallback = undefined;\n        this._started = false;\n        this._sounds = {};\n        this.currentAnimationName = undefined;\n        this.preloadSounds(sounds);\n        this._overlays = [this._el];\n        var curr = this._el;\n\n        this._setupElement(this._el);\n        for (var i = 1; i < this._data.overlayCount; i++) {\n            var inner = this._setupElement($('<div></div>'));\n\n            curr.append(inner);\n            this._overlays.push(inner);\n            curr = inner;\n        }\n    };\n\n    clippy.Animator.prototype = {\n        _setupElement:function (el) {\n            var frameSize = this._data.framesize;\n            el.css('display', \"none\");\n            el.css({width:frameSize[0], height:frameSize[1]});\n            el.css('background', \"url('\" + this._path + \"/map.png') no-repeat\");\n\n            return el;\n        },\n\n        animations:function () {\n            var r = [];\n            var d = this._data.animations;\n            for (var n in d) {\n                r.push(n);\n            }\n            return r;\n        },\n\n        preloadSounds:function (sounds) {\n\n            for (var i = 0; i < this._data.sounds.length; i++) {\n                var snd = this._data.sounds[i];\n                var uri = sounds[snd];\n                if (!uri) continue;\n                this._sounds[snd] = new Audio(uri);\n\n            }\n        },\n        hasAnimation:function (name) {\n            return !!this._data.animations[name];\n        },\n\n        exitAnimation:function () {\n            this._exiting = true;\n        },\n\n\n        showAnimation:function (animationName, stateChangeCallback) {\n            this._exiting = false;\n\n            if (!this.hasAnimation(animationName)) {\n                return false;\n            }\n\n            this._currentAnimation = this._data.animations[animationName];\n            this.currentAnimationName = animationName;\n\n\n            if (!this._started) {\n                this._step();\n                this._started = true;\n            }\n\n            this._currentFrameIndex = 0;\n            this._currentFrame = undefined;\n            this._endCallback = stateChangeCallback;\n\n            return true;\n        },\n\n\n        _draw:function () {\n            var images = [];\n            if (this._currentFrame) images = this._currentFrame.images || [];\n\n            for (var i = 0; i < this._overlays.length; i++) {\n                if (i < images.length) {\n                    var xy = images[i];\n                    var bg = -xy[0] + 'px ' + -xy[1] + 'px';\n                    this._overlays[i].css({'background-position':bg, 'display':'block'});\n                }\n                else {\n                    this._overlays[i].css('display', 'none');\n                }\n\n            }\n        },\n\n        _getNextAnimationFrame:function () {\n            if (!this._currentAnimation) return undefined;\n            // No current frame. start animation.\n            if (!this._currentFrame) return 0;\n            var currentFrame = this._currentFrame;\n            var branching = this._currentFrame.branching;\n\n\n            if (this._exiting && currentFrame.exitBranch !== undefined) {\n                return currentFrame.exitBranch;\n            }\n            else if (branching) {\n                var rnd = Math.random() * 100;\n                for (var i = 0; i < branching.branches.length; i++) {\n                    var branch = branching.branches[i];\n                    if (rnd <= branch.weight) {\n                        return branch.frameIndex;\n                    }\n\n                    rnd -= branch.weight;\n                }\n            }\n\n            return this._currentFrameIndex + 1;\n        },\n\n        _playSound:function () {\n            var s = this._currentFrame.sound;\n            if (!s) return;\n            var audio = this._sounds[s];\n            if (audio) audio.play();\n        },\n\n        _atLastFrame:function () {\n            return this._currentFrameIndex >= this._currentAnimation.frames.length - 1;\n        },\n\n        _step:function () {\n            if (!this._currentAnimation) return;\n            var newFrameIndex = Math.min(this._getNextAnimationFrame(), this._currentAnimation.frames.length - 1);\n            var frameChanged = !this._currentFrame || this._currentFrameIndex !== newFrameIndex;\n            this._currentFrameIndex = newFrameIndex;\n\n            // always switch frame data, unless we're at the last frame of an animation with a useExitBranching flag.\n            if (!(this._atLastFrame() && this._currentAnimation.useExitBranching)) {\n                this._currentFrame = this._currentAnimation.frames[this._currentFrameIndex];\n            }\n\n            this._draw();\n            this._playSound();\n\n            this._loop = window.setTimeout($.proxy(this._step, this), this._currentFrame.duration);\n\n\n            // fire events if the frames changed and we reached an end\n            if (this._endCallback && frameChanged && this._atLastFrame()) {\n                if (this._currentAnimation.useExitBranching && !this._exiting) {\n                    this._endCallback(this.currentAnimationName, clippy.Animator.States.WAITING);\n                }\n                else {\n                    this._endCallback(this.currentAnimationName, clippy.Animator.States.EXITED);\n                }\n            }\n        },\n\n        /***\n         * Pause animation execution\n         */\n        pause:function () {\n            window.clearTimeout(this._loop);\n        },\n\n        /***\n         * Resume animation\n         */\n        resume:function () {\n            this._step();\n        }\n    };\n\n    clippy.Animator.States = { WAITING:1, EXITED:0 };\n\n    /******\n     *\n     *\n     * @constructor\n     */\n    clippy.Balloon = function (targetEl) {\n        this._targetEl = targetEl;\n\n        this._hidden = true;\n        this._setup();\n    };\n\n    clippy.Balloon.prototype = {\n\n        WORD_SPEAK_TIME:320,\n        CLOSE_BALLOON_DELAY:2000,\n\n        _setup:function () {\n\n            this._balloon = $('<div class=\"clippy-balloon\"><div class=\"clippy-tip\"></div><div class=\"clippy-content\"></div></div> ').hide();\n            this._content = this._balloon.find('.clippy-content');\n\n            $(document.body).append(this._balloon);\n        },\n\n        reposition:function () {\n            var sides = ['top-left', 'top-right', 'bottom-left', 'bottom-right'];\n\n            for (var i = 0; i < sides.length; i++) {\n                var s = sides[i];\n                this._position(s);\n                if (!this._isOut()) break;\n            }\n        },\n\n        _BALLOON_MARGIN:15,\n\n        /***\n         *\n         * @param side\n         * @private\n         */\n        _position:function (side) {\n            var o = this._targetEl.offset();\n            var h = this._targetEl.height();\n            var w = this._targetEl.width();\n\n            var bH = this._balloon.outerHeight();\n            var bW = this._balloon.outerWidth();\n\n            this._balloon.removeClass('clippy-top-left');\n            this._balloon.removeClass('clippy-top-right');\n            this._balloon.removeClass('clippy-bottom-right');\n            this._balloon.removeClass('clippy-bottom-left');\n\n            var left, top;\n            switch (side) {\n                case 'top-left':\n                    // right side of the balloon next to the right side of the agent\n                    left = o.left + w - bW;\n                    top = o.top - bH - this._BALLOON_MARGIN;\n                    break;\n                case 'top-right':\n                    // left side of the balloon next to the left side of the agent\n                    left = o.left;\n                    top = o.top - bH - this._BALLOON_MARGIN;\n                    break;\n                case 'bottom-right':\n                    // right side of the balloon next to the right side of the agent\n                    left = o.left;\n                    top = o.top + h + this._BALLOON_MARGIN;\n                    break;\n                case 'bottom-left':\n                    // left side of the balloon next to the left side of the agent\n                    left = o.left + w - bW;\n                    top = o.top + h + this._BALLOON_MARGIN;\n                    break;\n            }\n\n            this._balloon.css({top:top, left:left});\n            this._balloon.addClass('clippy-' + side);\n        },\n\n        _isOut:function () {\n            var o = this._balloon.offset();\n            var bH = this._balloon.outerHeight();\n            var bW = this._balloon.outerWidth();\n\n            var wW = $(window).width();\n            var wH = $(window).height();\n            var sT = $(document).scrollTop();\n            var sL = $(document).scrollLeft();\n\n            var top = o.top - sT;\n            var left = o.left - sL;\n            var m = 5;\n            if (top - m < 0 || left - m < 0) return true;\n            if ((top + bH + m) > wH || (left + bW + m) > wW) return true;\n\n            return false;\n        },\n\n        speak:function (complete, text, hold) {\n            this._hidden = false;\n            this.show();\n            var c = this._content;\n            // set height to auto\n            c.height('auto');\n            c.width('auto');\n            // add the text\n            c.text(text);\n            // set height\n            c.height(c.height());\n            c.width(c.width());\n            c.text('');\n            this.reposition();\n\n            this._complete = complete;\n            this._sayWords(text, hold, complete);\n        },\n\n        show:function () {\n            if (this._hidden) return;\n            this._balloon.show();\n        },\n\n        hide:function (fast) {\n            if (fast) {\n                this._balloon.hide();\n                return;\n            }\n\n            this._hiding = window.setTimeout($.proxy(this._finishHideBalloon, this), this.CLOSE_BALLOON_DELAY);\n        },\n\n        _finishHideBalloon:function () {\n            if (this._active) return;\n            this._balloon.hide();\n            this._hidden = true;\n            this._hiding = null;\n        },\n\n        _sayWords:function (text, hold, complete) {\n            this._active = true;\n            this._hold = hold;\n            var words = text.split(/[^\\S-]/);\n            var time = this.WORD_SPEAK_TIME;\n            var el = this._content;\n            var idx = 1;\n\n\n            this._addWord = $.proxy(function () {\n                if (!this._active) return;\n                if (idx > words.length) {\n                    this._active = false;\n                    if (!this._hold) {\n                        complete();\n                        this.hide();\n                    }\n                } else {\n                    el.text(words.slice(0, idx).join(' '));\n                    idx++;\n                    this._loop = window.setTimeout($.proxy(this._addWord, this), time);\n                }\n            }, this);\n\n            this._addWord();\n\n        },\n\n        close:function () {\n            if (this._active) {\n                this._hold = false;\n            } else if (this._hold) {\n                this._complete();\n            }\n        },\n\n        pause:function () {\n            window.clearTimeout(this._loop);\n            if (this._hiding) {\n                window.clearTimeout(this._hiding);\n                this._hiding = null;\n            }\n        },\n\n        resume:function () {\n            if (this._addWord)  this._addWord();\n            this._hiding = window.setTimeout($.proxy(this._finishHideBalloon, this), this.CLOSE_BALLOON_DELAY);\n        }\n\n\n    };\n\n    clippy.BASE_PATH = '//s3.amazonaws.com/clippy.js/Agents/';\n\n    clippy.load = function (name, successCb, failCb) {\n        var path = clippy.BASE_PATH + name;\n\n        var mapDfd = clippy.load._loadMap(path);\n        var agentDfd = clippy.load._loadAgent(name, path);\n        var soundsDfd = clippy.load._loadSounds(name, path);\n\n        var data;\n        agentDfd.done(function (d) {\n            data = d;\n        });\n\n        var sounds;\n\n        soundsDfd.done(function (d) {\n            sounds = d;\n        });\n\n        // wrapper to the success callback\n        var cb = function () {\n            var a = new clippy.Agent(path, data,sounds);\n            successCb(a);\n        };\n\n        $.when(mapDfd, agentDfd, soundsDfd).done(cb).fail(failCb);\n    };\n\n    clippy.load._maps = {};\n    clippy.load._loadMap = function (path) {\n        var dfd = clippy.load._maps[path];\n        if (dfd) return dfd;\n\n        // set dfd if not defined\n        dfd = clippy.load._maps[path] = $.Deferred();\n\n        var src = path + '/map.png';\n        var img = new Image();\n\n        img.onload = dfd.resolve;\n        img.onerror = dfd.reject;\n\n        // start loading the map;\n        img.setAttribute('src', src);\n\n        return dfd.promise();\n    };\n\n    clippy.load._sounds = {};\n\n    clippy.load._loadSounds = function (name, path) {\n        var dfd = clippy.load._sounds[name];\n        if (dfd) return dfd;\n\n        // set dfd if not defined\n        dfd = clippy.load._sounds[name] = $.Deferred();\n\n        var audio = document.createElement('audio');\n        var canPlayMp3 = !!audio.canPlayType && \"\" != audio.canPlayType('audio/mpeg');\n        var canPlayOgg = !!audio.canPlayType && \"\" != audio.canPlayType('audio/ogg; codecs=\"vorbis\"');\n\n        if (!canPlayMp3 && !canPlayOgg) {\n            dfd.resolve({});\n        } else {\n            var src = path + (canPlayMp3 ? '/sounds-mp3.js' : '/sounds-ogg.js');\n            // load\n            clippy.load._loadScript(src);\n        }\n\n        return dfd.promise()\n    };\n\n\n    clippy.load._data = {};\n    clippy.load._loadAgent = function (name, path) {\n        var dfd = clippy.load._data[name];\n        if (dfd) return dfd;\n\n        dfd = clippy.load._getAgentDfd(name);\n\n        var src = path + '/agent.js';\n\n        clippy.load._loadScript(src);\n\n        return dfd.promise();\n    };\n\n    clippy.load._loadScript = function (src) {\n        var script = document.createElement('script');\n        script.setAttribute('src', src);\n        script.setAttribute('async', 'async');\n        script.setAttribute('type', 'text/javascript');\n\n        document.head.appendChild(script);\n    };\n\n    clippy.load._getAgentDfd = function (name) {\n        var dfd = clippy.load._data[name];\n        if (!dfd) {\n            dfd = clippy.load._data[name] = $.Deferred();\n        }\n        return dfd;\n    };\n\n    clippy.ready = function (name, data) {\n        var dfd = clippy.load._getAgentDfd(name);\n        dfd.resolve(data);\n    };\n\n    clippy.soundsReady = function (name, data) {\n        var dfd = clippy.load._sounds[name];\n        if (!dfd) {\n            dfd = clippy.load._sounds[name] = $.Deferred();\n        }\n\n        dfd.resolve(data);\n    };\n\n    /******\n     * Tiny Queue\n     *\n     * @constructor\n     */\n    clippy.Queue = function (onEmptyCallback) {\n        this._queue = [];\n        this._onEmptyCallback = onEmptyCallback;\n    };\n\n    clippy.Queue.prototype = {\n        /***\n         *\n         * @param {function(Function)} func\n         * @returns {jQuery.Deferred}\n         */\n        queue:function (func) {\n            this._queue.push(func);\n\n            if (this._queue.length === 1 && !this._active) {\n                this._progressQueue();\n            }\n        },\n\n        _progressQueue:function () {\n\n            // stop if nothing left in queue\n            if (!this._queue.length) {\n                this._onEmptyCallback();\n                return;\n            }\n\n            var f = this._queue.shift();\n            this._active = true;\n\n            // execute function\n            var completeFunction = $.proxy(this.next, this);\n            f(completeFunction);\n        },\n\n        clear:function () {\n            this._queue = [];\n        },\n\n        next:function () {\n            this._active = false;\n            this._progressQueue();\n        }\n    };\n\n}.call(this));"],"file":"clippy.js"}